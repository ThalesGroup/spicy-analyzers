[package]
depends = zeek/spicy-plugin *
script_dir = analyzer
plugin_dir = build/spicy-modules

build_command = mkdir -p build && cd build && SPICYZ=%(package_base)s/spicy-plugin/build/bin/spicyz cmake .. && make -j "${SPICY_ZKG_PROCESSES:-2}"

# If the package is already installed, the Spicy plugin would pull in both
# old and new *.hlto during testing. Hence we need to override the search path
# to point to only the new location.
#
# Note that zkg doesn't expand variables for the test_command, so we need to get
# spicyz out of the cache.
test_command = cd tests && SPICYZ=$(cat ../build/CMakeCache.txt | grep SPICYZ | cut -d = -f 2) btest -d -j "${SPICY_ZKG_PROCESSES:-2}" -a zkg
